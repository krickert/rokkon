# Unified test profile configuration
# This configuration is used by all tests using UnifiedTestProfile
quarkus:
  application:
    name: engine-consul-unified-test
  
  # Test profile
  test:
    profile: test-unified
  
  # Enable/disable features dynamically via UnifiedTestProfile
  consul-config:
    enabled: ${quarkus.consul-config.enabled:false}
    agent:
      host: ${consul.host:localhost}
      port: ${consul.port:8500}
    properties-value-keys:
      - config/unified-test  # Unified test namespace
    format: yaml
    watch: false
    fail-on-missing-key: false
  
  # HTTP configuration for tests
  http:
    test-port: 0  # Use random port for tests
  
  # Logging for tests
  log:
    level: INFO
    category:
      "com.rokkon":
        level: DEBUG
      "io.quarkus.test":
        level: DEBUG
      "io.quarkiverse.config.consul":
        level: DEBUG

# Test consul connection
consul:
  host: localhost
  port: 8500

# Unified test configuration with dynamic KV prefix
rokkon:
  engine:
    grpc-port: 49000
    rest-port: 8080
    debug: false
  
  consul:
    # KV prefix is set dynamically by UnifiedTestProfile
    kv-prefix: ${pipeline.consul.kv-prefix:test}
    cleanup:
      enabled: true
      interval: 5m
      zombie-threshold: 2m
      cleanup-stale-whitelist: true
    health:
      check-interval: 10s
      deregister-after: 1m
      timeout: 5s
  
  modules:
    auto-discover: false
    service-prefix: "module-"
    require-whitelist: true
    connection-timeout: 30s
    max-instances-per-module: 10
  
  default-cluster:
    name: default
    auto-create: true
    description: "Default cluster for unified tests"